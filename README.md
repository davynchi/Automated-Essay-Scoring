Пайплайн для обучения и инференса модели для автоматического выставления оценок
по написанным эссе.

# Automated Essay Scoring

### Давыдов Михаил

## Постановка задачи

Проблема -- учителя тратят слишком много времени на проверку эссе студентов и
школьников. Цель -- создать систему автоматического выставления оценок для эссе
школьников с помощью машинного обучения.

## Формат входных и выходных данных

На входе 3 файла: train.csv - эссе и их оценки, использумемые как данные для
тренировки. 3 колонки:

1. essay_id - уникальный id для эссе
2. full_text - полный текст эссе
3. score - честная оценка для эссе по шкале от 1 до 6

test.csv - эссе, использумеые как тестовые данные. Такие же поля, как в
train.csv, но без поля 'score'

sample_submission.csv - файл для сдачи в корректном формате. 2 колонки:

1. essay_id - уникальный id для эссе
2. score - предсказанная честная оценка для эссе по шкале от 1 до 6

Исходные оценки ставились по
[этим критериям](https://storage.googleapis.com/kaggle-forum-message-attachments/2733927/20538/Rubric_%20Holistic%20Essay%20Scoring.pdf).

## Метрики

Ответы оцениваются по метрике `quadratic weighted kappa`, показывающая степень
согласия между двумя оценками. Обычно метрика меняется от 0 (случайное согласие)
до 1 (полное согласие). Если степень согласия между метриками меньше, чем для
случайного, то оценка может уйти ниже 0.

`quadratic weighted kappa` вычисляется так: Сначала создается матрица $O$
размера $N \times N$, причем $O_{i,j}$ отвечает за количество эссе с изначальной
оценкой $i$ и получивших предсказание оценки $j$. Матрица весов $w$ размера
$N \times N$ создается по формуле:

$$
w_{i, j} = \frac{(i − j)^2}{(N − 1)^2}
$$

Матрица $E$ размера $N \times N$ вычисляется так: сначала создается вектора $u$
и $v$, у первого на $i$-ом месте стоит количество оценок $i$ в тестовой выборке,
$v$ -- так же, но для предсказанных значений. Далее $E = u \otimes v$,
нормализованное так, чтобы суммы элементов у $E$ и $O$ были одинаковыми.

`quadratic weighted kappa` из этих матриц вычисляется как:

$$
\kappa = 1 - \frac{\sum_{i, j}w_{i,j}O_{i,j}}{\sum_{i, j}w_{i,j}E_{i,j}}
$$

## Валидация

<Какой способ разделения выборок и проведения валидации вы будете использовать?
Как сделать его воспроизводимым?>

## Данные

<Какие данные и откуда вы хотите брать, какие у них есть особенности, что может
стать проблемой. Указать конкретные ссылки на данные>

## Бейзлайн

Бейзлайн -- взять языковую модель, подать на вход
[критерий оценивания](https://storage.googleapis.com/kaggle-forum-message-attachments/2733927/20538/Rubric_%20Holistic%20Essay%20Scoring.pdf)
в качестве промта и попросить оценить для поданного текста из тестовой выборки
итоговую оценку. То есть не используем обучающую выборку совсем.

## Основная модель

<Опишите саму модель (со ссылками), способ её обучения>

## Внедрение

<Опишите, в каком виде ваша модель будет использоваться (пакет, сервис, чат бот,
etc). Нужны ли для этого метода какие-то дополнительные компоненты? Это поможет
вам учитывать это при проектировании кода модели>

## План реализации проекта

- [x] Выбрать проект
- [x] Разобраться с conda и poetry
- [x] Разделить проект по функциям
- [x] Добавить средства поддержки quality tools
- [x] Научить запускать проект как локально, так и в Kaggle
- [x] Заставить проект работать
- [x] Первичный рефакторинг
- [x] Отдебажить конфигурации с гидрой
- [ ] Отрефакторить (в том числе убрать все ворнинги)
- [ ] Дописать readme.md
- [ ] Изменить поведение логгера
- [ ] Добавить MLFlow
- [ ] Добавить Lightning
- [ ] Запустить на всех данных и попытаться сделать рабочим
- [ ] Добавить бейзлайн
- [ ] Добавить поддержку данных через dvc
- [ ] Написать документацию
- [ ] Написать тесты
